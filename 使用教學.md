# 📊 Screener 使用教學

這個專案是一個強大的加密貨幣和股票篩選工具，使用相對強度分析和動態時間規整（DTW）算法來識別強勢標的和相似趨勢模式。

## 🚀 快速開始

### 1. 環境設置

確保你已經安裝了所有依賴項目：

```bash
pip3 install -r requirements.txt
```

### 2. API Keys 設置（可選）

編輯 `api_keys.json` 文件：

```json
{
  "stocksymbol": "你的_STOCKSYMBOL_API_KEY",
  "polygon": "你的_POLYGON_API_KEY"
}
```

**注意：** 
- 加密貨幣功能不需要 API keys
- 股票功能需要 Polygon API key 才能獲得完整功能
- 如果沒有 API keys，程式會使用備用股票列表

## 📈 功能介紹

### 1. 加密貨幣篩選器 (crypto_screener.py)

**功能：** 識別相對強勢的加密貨幣

**使用方法：**

```bash
# 基本使用（15分鐘時間框架，3天數據）
python3 crypto_screener.py

# 自定義參數
python3 crypto_screener.py -t "1h" -d 7    # 1小時時間框架，7天數據
python3 crypto_screener.py -t "4h" -d 14   # 4小時時間框架，14天數據
```

**參數說明：**
- `-t, --timeframe`: 時間框架 (5m, 15m, 30m, 1h, 2h, 4h, 8h, 1d)
- `-d, --days`: 計算天數 (預設 3 天)

**輸出：**
- 控制台顯示前 20 名強勢加密貨幣
- 生成 TXT 文件在 `output/<日期>/` 目錄，可導入 TradingView

### 2. 股票篩選器 (stock_screener.py)

**功能：** 使用相對強度計算和 Minervini 趨勢模板分析美股

**使用方法：**

```bash
# 基本使用
python3 stock_screener.py

# 包含所有強勢標的（不限制數量）
python3 stock_screener.py -a

# 只計算 RS 分數，忽略 Minervini 條件
python3 stock_screener.py -g
```

**參數說明：**
- `-a, --all`: 包含所有強勢標的（不限制為 980 個）
- `-g`: 忽略 Minervini 趨勢模板條件，只計算 RS 分數

### 3. 加密貨幣趨勢篩選器 (crypto_trend_screener.py)

**功能：** 使用 DTW 算法找到與預定義參考趨勢相似的加密貨幣價格模式

**使用方法：**

```bash
# 基本使用
python3 crypto_trend_screener.py

# 使用強勢標的文件
python3 crypto_trend_screener.py -f output/2025-06-15/strong_targets.txt

# 自定義參數
python3 crypto_trend_screener.py -k 20 -s 1.0
```

**參數說明：**
- `-f, --file`: 強勢標的文件路徑
- `--asset`: 資產類型 ('crypto' 或 'stock')
- `-nv, --no_visualize`: 禁用 DTW 對齊視覺化
- `-k, --topk`: 每個參考趨勢記錄的頂級符號數量 (預設: 10)
- `-s, --sleep`: API 請求間隔秒數 (預設: 0.5)

### 4. 加密貨幣歷史趨勢分析器 (crypto_historical_trend_finder.py)

**功能：** 搜索歷史加密貨幣數據中與參考趨勢相似的模式，並分析其未來價格走勢

**使用方法：**

```bash
# 基本使用
python3 crypto_historical_trend_finder.py

# 自定義參數
python3 crypto_historical_trend_finder.py -k 500 -s 10
```

**參數說明：**
- `-k, --topk`: 每個參考趨勢保留的頂級匹配數量 (預設: 300)
- `-s, --sleep`: API 請求間隔秒數 (預設: 15)

## 📊 相對強度公式

程式使用以下公式計算相對強度分數：

```
bars = 總柱數（取決於時間框架，例如 15m 為 4 × 24 × 天數）

W_i = e^(2 × ln(2) × i / bars)

N_i = [(P_i - MA30_i) + (P_i - MA45_i) + (P_i - MA60_i) + 
       (MA30_i - MA45_i) + (MA30_i - MA60_i) + (MA45_i - MA60_i)] / ATR_i

Score = Σ(N_i × W_i) / Σ(W_i)
```

其中：
- 權重計算為指數函數，使中點權重正好是終點權重的一半
- ATR（平均真實範圍）用於標準化

## 🎯 實際使用範例

### 範例 1：找出當前強勢加密貨幣

```bash
# 使用 1 小時時間框架，分析過去 5 天
python3 crypto_screener.py -t "1h" -d 5
```

**預期輸出：**
```
Total cryptos to process: 476
Successfully calculated: 421
=========================== Target : Score (TOP 20) ===========================
1. TUSDT: 20.531955
2. MEMEFIUSDT: 11.139979
3. THEUSDT: 9.819653
...
```

### 範例 2：分析股票相對強度

```bash
# 分析美股，只計算 RS 分數
python3 stock_screener.py -g
```

### 範例 3：尋找相似趨勢模式

```bash
# 先運行加密貨幣篩選器
python3 crypto_screener.py -t "4h" -d 7

# 然後使用結果文件進行趨勢分析
python3 crypto_trend_screener.py -f output/2025-06-15/2025-06-15_21-01_crypto_4h_strong_targets.txt -k 15
```

## 📁 輸出文件說明

### 加密貨幣篩選器輸出
- **位置：** `output/<日期>/<時間戳>_crypto_<時間框架>_strong_targets.txt`
- **格式：** TradingView 監視列表格式
- **內容：** 按 RS 分數排序的加密貨幣列表

### 股票篩選器輸出
- **位置：** `output/<日期>/<時間戳>_stock_strong_targets_<top_980|all>.txt`
- **格式：** TradingView 監視列表格式
- **內容：** 按 RS 分數排序的股票列表

### 趨勢篩選器輸出
- **位置：** `similarity_output/<時間戳>/`
- **內容：** 
  - TXT 文件：相似趨勢列表
  - PNG 文件：DTW 對齊視覺化圖表

### 歷史趨勢分析器輸出
- **位置：** `past_similar_trends_report/<時間戳>/`
- **內容：**
  - `overall_summary.txt`：統計摘要
  - PNG 文件：三面板分析圖（過去/模式/未來）
  - 詳細的統計報告

## ⚠️ 注意事項

### API 限制
- **Binance API：** 每分鐘 2400 請求限制
- **解決方案：** 程式已內建重試機制和指數退避

### 數據品質
- 程式會自動驗證數據品質
- 過濾掉停滯價格和過時數據

### 系統要求
- **Python 3.8+**
- **記憶體：** 建議 4GB+ （處理大量數據時）
- **網路：** 穩定的網路連接（用於 API 調用）

## 🔧 故障排除

### 常見問題

**1. "Too many requests" 錯誤**
```
解決方案：程式會自動重試，或者減少並行進程數量
```

**2. "Failed to get data" 錯誤**
```
解決方案：檢查網路連接，某些加密貨幣可能已下市
```

**3. "StockSymbol API failed" 錯誤**
```
解決方案：程式會自動使用備用股票列表，或設置有效的 API key
```

**4. 記憶體不足**
```
解決方案：減少分析的時間範圍或使用更少的並行進程
```

### 性能優化

**1. 調整並行進程數量**
```python
# 在 crypto_screener.py 中修改
num_cores = min(2, mp.cpu_count())  # 減少到 2 個進程
```

**2. 增加 API 請求間隔**
```bash
python3 crypto_trend_screener.py -s 2.0  # 增加到 2 秒間隔
```

## 📚 進階配置

### 自定義參考趨勢

編輯 `crypto_historical_trend_finder.py` 中的 `REFERENCE_TRENDS`：

```python
REFERENCE_TRENDS = {
    "AVAX": [
        [datetime(2023, 11, 9, 12, 0), datetime(2023, 11, 14, 18, 0), "1h", "standard"],
    ],
    "你的幣種": [
        [datetime(年, 月, 日, 時, 分), datetime(年, 月, 日, 時, 分), "時間框架", "標籤"],
    ]
}
```

### 調整 DTW 參數

```python
# 在相應文件中修改這些參數
DTW_WINDOW_RATIO = 0.12          # DTW 窗口比例
PRICE_WEIGHT = 0.6               # 價格權重
DIFF_WEIGHT = 0.4                # 差異權重
MIN_SIMILARITY_SCORE = 0.25      # 最小相似度分數
```

## 🎉 開始使用

現在你已經了解了如何使用這個強大的篩選工具！建議從簡單的加密貨幣篩選開始：

```bash
python3 crypto_screener.py
```

然後逐步探索更高級的功能。祝你交易順利！ 🚀📈 